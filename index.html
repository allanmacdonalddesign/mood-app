<!DOCTYPE html>
<html>
<head>
  <title>Mood Morph Slider</title>
  
  <!-- Open Graph meta tags for social media sharing -->
  <meta property="og:title" content="Mood App - Track Your Daily Moods">
  <meta property="og:description" content="A beautiful mood tracking app with animated expressions">
  <meta property="og:image" content="https://allanmacdonalddesign.github.io/mood-app/share-gifs/happy-500x500.gif">
  <meta property="og:url" content="https://allanmacdonalddesign.github.io/mood-app/">
  <meta property="og:type" content="website">
  
  <!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Mood App - Track Your Daily Moods">
  <meta name="twitter:description" content="A beautiful mood tracking app with animated expressions">
  <meta name="twitter:image" content="https://allanmacdonalddesign.github.io/mood-app/share-gifs/happy-500x500.gif">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.15/paper-full.min.js"></script>
  <style>
    :root {
      --page-bg: white;
      --page-text: #333;
      --page-stroke: #333;
    }

    html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: var(--page-bg);
    color: var(--page-text);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  #background {
    position: relative;
    width: 100%;
    height: 100%;
    background: var(--page-bg);
    transition: background-color 0.5s ease; /* ðŸ‘ˆ This is the magic */
  }

  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  #moodLabel {
  position: absolute;
  bottom: 12%;
  left: 50%;
  transform: translateX(-50%);
  width: min(300px);
  pointer-events: none;
}
  #moodSlider {
  position: absolute;
  bottom: 200px;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 14px;
  pointer-events: auto;
  position: relative;
  z-index: 5;
}

#dateDisplay {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: transparent;
  padding: 12px 24px;
  border-radius: 25px;
  border: 2px solid var(--page-stroke);
  color: var(--page-text);
  font-family: 'SF Pro Display', 'Helvetica Neue', 'Avenir Next', 'Segoe UI', 'Roboto', sans-serif;
  font-weight: 700;
  font-size: 18px;
  letter-spacing: 0.5px;
  cursor: pointer;
  pointer-events: auto;
  transition: transform 0.1s ease, opacity 0.1s ease, border-color 0.3s ease, color 0.3s ease;
  user-select: none;
}

#dateDisplay:hover {
  transform: translateX(-50%) scale(1.05);
  opacity: 0.8;
}

#submitButton {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: transparent;
  border: 2px solid var(--page-stroke);
  color: var(--page-text);
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  transition: transform 0.1s ease, opacity 0.1s ease, border-color 0.3s ease, color 0.3s ease;
  pointer-events: auto;
  z-index: 10;
}

#submitButton:hover {
  transform: translateX(-50%) scale(1.05);
  opacity: 0.8;
}

#darkOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.2);
  display: none;
  z-index: 100;
  pointer-events: auto;
}

#noteInput {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 80%;
  max-width: 400px;
  height: 100px;
  padding: 15px;
  border: 2px solid rgba(255, 255, 255, 0.8);
  border-radius: 15px;
  background: rgba(255, 255, 255, 0.95);
  font-size: 14px;
  font-family: 'Inter', sans-serif;
  resize: vertical;
  display: none;
  pointer-events: auto;
  z-index: 101;
}

#confirmButton {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.9);
  border: 2px solid #333;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 16px;
  color: #333;
  cursor: pointer;
  transition: all 0.3s ease;
  pointer-events: auto;
  display: none;
  z-index: 101;
}

#confirmButton:hover {
  background: #333;
  color: white;
  transform: translateX(-50%) scale(1.05);
}

#closeButton {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.9);
  border: 2px solid #333;
  border-radius: 50%;
  font-size: 20px;
  font-weight: bold;
  color: #333;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 102;
  pointer-events: auto;
  transition: all 0.3s ease;
}

#closeButton:hover {
  background: #333;
  color: white;
  transform: scale(1.1);
}

/* Calendar View Styles */
#calendarView {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--page-bg);
  color: var(--page-text);
  z-index: 200;
  padding: 0;
  box-sizing: border-box;
  overflow-y: auto;
  font-family: 'Termina', 'Gabarito', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s ease, color 0.3s ease;
}

#calendarHeader {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 45px 0 40px;
  position: relative;
  border-top: 1px solid var(--page-stroke);
  border-bottom: 1px solid var(--page-stroke);
  margin-top: 40px;
  margin-bottom: 40px;
  width: 600px;
  margin-left: auto;
  margin-right: auto;
  transition: border-color 0.3s ease;
}

#calendarHeader button {
  background: var(--page-stroke);
  color: var(--page-bg);
  border: none;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease, background-color 0.3s ease, color 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
}

#calendarHeader button:first-child {
  left: 0;
}

#calendarHeader button:last-child {
  right: 0;
}

#calendarHeader button:hover {
  background: var(--page-text);
  opacity: 0.8;
}

#calendarMonthYear {
  display: flex;
  align-items: baseline;
  gap: 100px;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

#calendarMonthNumber {
  font-size: 48px;
  font-weight: bold;
  color: var(--page-text);
  line-height: 1;
  transition: color 0.3s ease;
}

#calendarYear {
  font-size: 48px;
  font-weight: bold;
  color: var(--page-text);
  line-height: 1;
  transition: color 0.3s ease;
}

#calendarContent {
  display: flex;
  align-items: center;
  gap: 0px;
  max-width: 1200px;
  width: 100%;
  padding: 0 60px;
  justify-content: center;
  position: relative;
  margin: 0 auto;
}

#calendarMonthName {
  font-size: 180px;
  font-weight: bold;
  color: var(--page-text);
  writing-mode: horizontal-tb;
  text-orientation: mixed;
  line-height: 0.8;
  letter-spacing: -2px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 80px;
  transform: rotate(270deg);
  position: absolute;
  left: -15px;
  transition: color 0.3s ease;
}

#calendarGrid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: var(--page-stroke);
  padding: 1px;
  width: 100%;
  max-width: 600px;
  transition: background-color 0.3s ease;
}

.calendar-day-header {
  background: var(--page-bg);
  font-weight: 300;
  color: var(--page-text);
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: default;
  display: flex;
  align-items: center;
  justify-content: center;
  aspect-ratio: 1;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.calendar-day-header:hover {
  background: var(--page-bg);
  transform: none;
}

.calendar-day {
  aspect-ratio: 1;
  background: var(--page-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 300;
  cursor: pointer;
  transition: all 0.2s ease, background-color 0.3s ease, color 0.3s ease;
  position: relative;
  font-size: 16px;
  color: var(--page-text);
}

.calendar-day:hover {
  background: rgba(0, 0, 0, 0.05);
}

.calendar-day.has-mood {
  background: #ff6b35;
  color: white;
  position: relative;
  overflow: hidden;
}

.calendar-day.has-mood:hover {
  background: #e55a2b;
}

.calendar-day.today {
  background: #fff3cd;
  border: 2px solid #ffc107;
}

.calendar-day.today.has-mood {
  border: 2px solid #333;
}

.day-number {
  font-size: 16px;
  color: inherit;
  font-weight: 300;
  z-index: 5;
  position: absolute;
  top: 8px;
  left: 8px;
}

.mood-indicator {
  position: absolute;
  bottom: 8px;
  right: 8px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: white;
  opacity: 0.8;
}

.mood-png {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 32px;
  height: 32px;
  opacity: 1;
  pointer-events: none;
}

#backToMood {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--page-stroke);
  color: var(--page-bg);
  border: none;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: 700;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s ease, background-color 0.3s ease, color 0.3s ease;
  text-transform: lowercase;
  font-family: 'SF Pro Display', 'Helvetica Neue', 'Avenir Next', 'Segoe UI', 'Roboto', sans-serif;
  letter-spacing: 0.5px;
}

#backToMood:hover {
  background: var(--page-text);
  opacity: 0.8;
}

/* Toast Notification Styles */
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateX(100%);
  background: var(--page-stroke);
  color: var(--page-bg);
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  font-family: 'Gabarito', sans-serif;
  z-index: 1000;
  transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease;
  opacity: 0;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.toast.show {
  transform: translateX(-50%);
  opacity: 1;
}

/* Mood Details Modal Styles */
#moodDetailsOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 300;
  display: flex;
  align-items: center;
  justify-content: center;
}

#moodDetailsModal {
  background: white;
  border-radius: 8px;
  padding: 0;
  max-width: 300px;
  width: 90%;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  font-family: 'Inter', sans-serif;
}

#moodDetailsHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid #e0e0e0;
}

#moodDetailsDate {
  font-size: 14px;
  font-weight: 500;
  color: #333;
  margin: 0;
}

#closeMoodDetails {
  background: none;
  border: none;
  font-size: 16px;
  color: #666;
  cursor: pointer;
  padding: 0;
  width: 20px;
  height: 20px;
  
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 3px;
  transition: all 0.2s ease;
}

#closeMoodDetails:hover {
  background: #f0f0f0;
  color: #333;
}

#moodDetailsContent {
  padding: 16px;
}

#moodDetailsMood {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 12px;
  padding: 16px;
  border-radius: 6px;
  text-align: center;
}

#moodDetailsMood img {
  width: 50px;
  height: 50px;
  margin-bottom: 8px;
}

#moodDetailsMood span {
  font-size: 16px;
  font-weight: 600;
}

#moodDetailsNote {
  background: #f8f9fa;
  padding: 10px 12px;
  border-radius: 4px;
  font-size: 13px;
  line-height: 1.3;
  color: #555;
  min-height: 40px;
}

/* Full-Screen Mood Details Styles */
#moodDetailsFullScreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 300;
  display: flex;
  flex-direction: column;
  font-family: 'Inter', sans-serif;
}

#moodDetailsFullHeader {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 301;
}

#closeMoodDetailsFull {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.3);
  color: white;
  font-size: 18px;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 6px;
  transition: all 0.2s ease;
  font-weight: 600;
}

#closeMoodDetailsFull:hover {
  background: rgba(255, 255, 255, 0.3);
  border-color: rgba(255, 255, 255, 0.5);
}

#moodDetailsFullContent {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#moodDetailsFullDate {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: transparent;
  border: 2px solid;
  border-radius: 25px;
  padding: 12px 24px;
  font-size: 18px;
  font-family: 'SF Pro Display', 'Helvetica Neue', 'Avenir Next', 'Segoe UI', 'Roboto', sans-serif;
  font-weight: 700;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: transform 0.1s ease, opacity 0.1s ease;
  z-index: 10;
}

#moodDetailsFullDate:hover {
  transform: translateX(-50%) scale(1.05);
  opacity: 0.8;
}

#moodFaceFull {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 300px;
  height: 300px;
  object-fit: contain;
  z-index: 5;
}

#moodCanvasFull {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  pointer-events: auto;
}

#moodLabelFull {
  position: absolute;
  bottom: 15%;
  left: 50%;
  transform: translateX(-50%);
  width: min(300px, 50vw);
  pointer-events: none;
  z-index: 10;
}

#moodDetailsFullNote {
  position: absolute;
  bottom: 5%;
  left: 50%;
  transform: translateX(-50%);
  max-width: 600px;
  width: 90%;
  font-size: 16px;
  line-height: 1.6;
  text-align: center;
  padding: 15px 20px;
  z-index: 10;
}

.slider-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  position: relative;
  transition: background 0.3s ease, transform 0.3s ease;
}

#moodThumb {
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 28px;
  height: 28px;
  background: black;
  border-radius: 50%;
  pointer-events: none; /* It lets mouse events fall through to moodSlider */
  transition: transform 0.2s ease, background 0.3s ease;
  z-index: 2;
}

#moodFace {
  position: absolute;
  left: 50%;
  top: 45%;
  transform: translate(-50%, -50%);
  width: 18vw;
  max-width: 270px;
  min-width: 270px;
  aspect-ratio: 1;
}



.slider-dot.active {
  transform: scale(1.4);
}

/* Share Button Styles */
#shareMoodButton {
  position: absolute;
  top: 20px;
  left: 20px;
  background: var(--page-stroke);
  color: var(--page-bg);
  border: none;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s ease, background-color 0.3s ease, color 0.3s ease;
  text-transform: lowercase;
  font-family: 'SF Pro Display', 'Helvetica Neue', 'Avenir Next', 'Segoe UI', 'Roboto', sans-serif;
  letter-spacing: 0.5px;
  z-index: 10;
}

#shareMoodButton:hover {
  background: var(--page-text);
  opacity: 0.8;
}

/* Share Modal Styles */
#shareModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 400;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

#shareModalContent {
  background: var(--page-bg);
  border-radius: 20px;
  padding: 30px;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  transition: background-color 0.3s ease;
}

#shareModalHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  border-bottom: 1px solid var(--page-stroke);
  padding-bottom: 15px;
  transition: border-color 0.3s ease;
}

#shareModalHeader h3 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
  color: var(--page-text);
  transition: color 0.3s ease;
  font-family: 'Gabarito', sans-serif;
}

#closeShareModal {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--page-text);
  transition: color 0.3s ease;
  padding: 5px;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#closeShareModal:hover {
  background: rgba(0, 0, 0, 0.1);
}

#shareGifContainer {
  text-align: center;
  margin-bottom: 25px;
}

#shareGif {
  max-width: 100%;
  max-height: 300px;
  border-radius: 15px;
  border: none;
  outline: none;
  display: block;
}

#shareOptions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.share-option {
  background: var(--page-stroke);
  color: var(--page-bg);
  border: none;
  padding: 12px 16px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  text-decoration: none;
  text-align: center;
  transition: all 0.2s ease, background-color 0.3s ease, color 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'SF Pro Display', 'Helvetica Neue', 'Avenir Next', 'Segoe UI', 'Roboto', sans-serif;
}

.share-option:hover {
  background: var(--page-text);
  opacity: 0.8;
  transform: translateY(-2px);
}

#downloadGif {
  grid-column: 1 / -1;
  background: var(--page-text);
  color: var(--page-bg);
}

#downloadGif:hover {
  background: var(--page-stroke);
}
  </style>
</head>
<body>
  
  <body>
    <div id="background">
      <div id="dateDisplay"></div>
      <video id="moodFace" autoplay loop muted playsinline></video>
      <canvas id="moodCanvas"></canvas>
      <img id="moodLabel"/>
      <div id="moodSlider">
        <!-- Dots (auto-generated like you already do in JS) -->
        <div id="moodThumb"></div> <!-- This is the draggable ball! -->
      </div>
      <button id="submitButton">SUBMIT</button>
    </div>
    
    <!-- Note input overlay -->
    <div id="darkOverlay"></div>
    <textarea id="noteInput" placeholder="How are you feeling? What's on your mind?"></textarea>
    <button id="confirmButton">CONFIRM</button>
    <button id="closeButton">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    
    <!-- Calendar view -->
    <div id="calendarView" style="display: none;">
      <div id="calendarHeader">
        <button id="prevMonth">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>
        <div id="calendarMonthYear">
          <span id="calendarMonthNumber"></span>
          <span id="calendarYear"></span>
        </div>
        <button id="nextMonth">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>
      
      <div id="calendarContent">
        <div id="calendarMonthName"></div>
        <div id="calendarGrid"></div>
      </div>
      
      <button id="backToMood">Back to moods</button>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage">mood entry submitted</span>
    </div>
    
    <!-- Mood Details Modal -->
    <div id="moodDetailsOverlay" style="display: none;">
      <div id="moodDetailsModal">
        <div id="moodDetailsHeader">
          <span id="moodDetailsDate"></span>
          <button id="closeMoodDetails">Ã—</button>
        </div>
        <div id="moodDetailsContent">
          <div id="moodDetailsMood"></div>
          <div id="moodDetailsNote"></div>
        </div>
      </div>
    </div>
    
    <!-- Full-Screen Mood Details View -->
    <div id="moodDetailsFullScreen" style="display: none;">
      <div id="moodDetailsFullHeader">
        <button id="closeMoodDetailsFull">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div id="moodDetailsFullContent">
        <div id="moodDetailsFullDate"></div>
        <video id="moodFaceFull" autoplay loop muted playsinline></video>
        <canvas id="moodCanvasFull"></canvas>
        <img id="moodLabelFull"/>
        <div id="moodDetailsFullNote"></div>
        <button id="shareMoodButton">Share This Mood</button>
      </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" style="display: none;">
      <div id="shareModalContent">
                <div id="shareModalHeader">
                  <h3>Share Your Mood</h3>
                  <button id="closeShareModal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
        <div id="shareGifContainer">
          <img id="shareGif" src="" alt="Mood GIF" />
        </div>
                <div id="shareOptions">
                  <button id="downloadGif" class="share-option">Download GIF</button>
                  <button id="copyGifLink" class="share-option">Copy GIF Link</button>
                  <a id="shareLinkedIn" class="share-option" target="_blank" rel="noopener">Share on LinkedIn</a>
                  <a id="shareFacebook" class="share-option" target="_blank" rel="noopener">Share on Facebook</a>
                  <a id="shareTwitter" class="share-option" target="_blank" rel="noopener">Share on Twitter</a>
                </div>
      </div>
    </div>
  </body>
<script>
  paper.setup(document.getElementById('moodCanvas'));
  
  const moodPaths = {
  excited: { color: '#09C35D', 
              bg: "#FFFD8A",
              moodlabel: "emotions-text/EXCITED.png",
              path: "M 111.76 334.313 L 90.79396270904887 311.43253031664483 L 64.13844989378963 295.16265386208306 L 35.50439205801977 282.5977397512876 L 6.007534599035169 272.1489995349522 L 24.77113478344231 267.3268199792458 L 55.58539865925623 262.08878339334774 L 85.72299352265262 253.81979281140448 L 113.54574590092366 239.86906492992378 L 133.49846010632157 216.20956667499865 L 138.67453917485983 185.63750459436312 L 133.52347760877305 154.84149534556332 L 123.56049196539279 125.24356453536463 L 111.1767612315193 96.5812454092409 L 97.36342617164759 68.45322030617456 L 117.33483375068883 78.10421834694962 L 144.49687201009985 93.56113402131992 L 172.81747856434237 106.78024707970752 L 202.75898470009554 115.66920554472688 L 233.80937716538213 115.07804489748663 L 259.79848520712227 98.63577234415786 L 275.5455580725145 71.80210247338566 L 284.46046391904883 41.854593031369276 L 289.63750737624554 10.92266292419054 L 293.67365622231233 21.656753490874 L 300.9002320923699 51.886655071605745 L 313.83648875615313 80.26516562479331 L 336.17297218900234 101.6870991544618 L 366.5119370238448 107.0863463834079 L 396.3846700443998 98.53009608591103 L 423.6763107280392 83.05878058211027 L 448.59346487254385 64.19282111080648 L 438.50253631665606 93.24530234444052 L 432.5241331685845 123.99929995248854 L 435.57394301181995 154.81963918586163 L 454.505222429706 179.0091748749803 L 483.687833088332 189.255179459775 L 515.1120182954677 190.61736142529116 L 545.9819645461123 187.39746096475957 L 576.8334756694425 181.4518604583761 L 563.6608851387606 194.9961457246339 L 539.8097949254861 215.3445435881658 L 517.9541014787469 237.6714231123289 L 500.11430917318614 263.34170682616354 L 492.22179247275216 293.2818494953378 L 501.57756027909187 322.757690492299 L 522.3723522153618 345.7262420643124 L 547.6691437922409 364.03142919783136 L 574.8982271472761 379.5446611678286 L 561.3722912246766 386.5545971257634 L 530.5158093201703 391.7830426242616 L 500.16755299896954 399.53756896706193 L 471.64629690055 411.9922160309052 L 448.2991293605458 432.51605533925255 L 434.9114529833003 460.64167001882277 L 429.8767043180614 491.4689376422607 L 429.141897470764 522.733233726722 L 430.4492415117183 554.0086887728116 L 421.8819881580709 555.8101110971016 L 402.1771214851414 531.6400198371242 L 379.7534279056325 509.99872778295526 L 352.8224473289415 494.18268294502576 L 322.00229290189475 491.8884110777635 L 293.7108088950047 504.7261436192101 L 269.96188237907006 524.8169241344013 L 248.9307261612242 547.851608595475 L 231.6183591055937 564.8726209236343 L 228.24379540576444 533.6714907965146 L 221.8874010114034 503.19949304350246 L 209.95038640200286 474.313531337527 L 188.71464277412755 451.9285565182338 L 159.20687081369414 442.04124512979513 L 127.99761253872408 441.9025228092387 L 96.9977102751251 446.30293460720975 L 66.37794302541685 452.7137822351783 L 68.54037114565593 442.34688900616925 L 89.82528546295084 419.350703598287 L 107.61464487046214 393.8313671217834 L 117.81512212207602 364.46972231228943 L 111.76 334.313" },
  happy: { color: '#FF86EF', 
            bg: "#D1FFAE",
            moodlabel: "emotions-text/HAPPY.png",
            path: "M 126.129 3.067 L 141.205821880555 6.073741210080262 L 156.28264376110997 9.080482420160523 L 171.35946564166494 12.087223630240786 L 186.4362875222199 15.093964840321046 L 201.51310940277492 18.100706050401307 L 216.5899272656498 21.107467406416152 L 231.6667446695102 24.11423106407677 L 246.74356207337058 27.12099472173739 L 261.82034600347424 30.127926215615823 L 276.89708597165367 33.13507813300852 L 291.97382593983303 36.14223005040121 L 307.05056590801246 39.14938196779391 L 321.79232712306913 43.39748705324162 L 335.5470904251627 50.24605033523237 L 347.82535557584373 59.473012326450615 L 358.23242965291445 70.756186229717 L 366.4464895621925 83.71878363380159 L 372.2036440247162 97.94619469150341 L 375.29814200669296 112.98955321336966 L 375.61049614573574 128.34976312662894 L 373.27676801824055 143.52140923181145 L 370.2701261002697 158.59825091343737 L 367.26322000583224 173.67503991055366 L 364.25615556801483 188.75179732675863 L 361.24937101481044 203.82861055934572 L 358.24266542649406 218.90543954374223 L 355.2357176768297 233.9822202330911 L 352.228633598123 249.05897373186795 L 348.8499329851421 264.04153553929007 L 344.0563644409958 278.64698041676303 L 337.81757261462025 292.701177622861 L 330.1944773152419 306.04955987674856 L 321.2687142958555 318.5548258510814 L 311.1328912124584 330.09897994219716 L 299.8896742030173 340.5749906146366 L 287.6578359314721 349.87750771327336 L 274.560772652062 357.916272342386 L 260.72812906124994 364.61053337447527 L 246.29565826187016 369.8883405342566 L 231.40634083920762 373.6910515145017 L 216.21445759303688 375.97339212116344 L 200.86121471718266 376.71180503302264 L 185.50885028869982 375.90128210988047 L 170.32490771044996 373.56903237028644 L 155.24805125720144 370.5624645246337 L 140.17119480395294 367.55589667898073 L 125.09433835070436 364.5493288333278 L 110.18109896438786 360.9277285043062 L 95.67648756460079 355.83653364122847 L 81.75046214914173 349.30811526212625 L 68.55677631495321 341.4079101280703 L 56.23150163894515 332.2212658812309 L 44.895184092435116 321.8476140138845 L 34.65521645470433 310.3962424250886 L 25.60771589373228 297.98310230233045 L 17.837595164705096 284.72516671460426 L 11.427464425027356 270.75839902947223 L 6.446483394959984 256.22029026727233 L 2.9517413455666848 241.25825110258506 L 0.9825060981652453 226.02043366641172 L 0.5606707404976007 210.65372780512158 L 1.68531117182524 195.3221289788437 L 4.277346513617098 180.17935594391705 L 7.284272613724301 165.10257093697226 L 10.29103722909936 150.02575373641474 L 13.297872441219198 134.94895060395504 L 16.30456154769087 119.87211833776126 L 19.31162938529058 104.79536159964997 L 22.318542349396346 89.71857397261911 L 25.325194607050232 74.64173435292555 L 28.930561193141738 59.721006167546236 L 35.02775047367008 45.61936882828356 L 43.58093498160524 32.8613413252314 L 54.29148959001396 21.86602622196886 L 66.80052138380029 12.971555636799177 L 80.70478822130063 6.461033843456226 L 95.55224493161516 2.56418685503152 L 110.86463786774749 1.4233565108769064 L 126.12899999999992 3.066999999999982" },
  content: { color: '#F7A416', 
              bg: "#FEDBFF",
              moodlabel: "emotions-text/CONTENT.png",
            path: "M 113.168 367.865 L 89.3745535392812 369.77700629322953 L 65.877018519679 365.48277152686944 L 44.31200804657236 355.27315329506786 L 26.024818127294044 339.92410493519833 L 12.183286381021777 320.47190526278825 L 3.7551582420682657 298.14953063853505 L 1.3668669296713534 274.3666276217041 L 4.443100735565216 250.66886430878566 L 8.828499518533798 227.17894111683265 L 18.090746526713197 205.1350941383562 L 32.943549093123266 186.45375694954663 L 52.256585607423595 172.45275580118846 L 74.58147337137314 164.0045676820409 L 98.33110253290607 161.6963101987518 L 121.82623613734074 165.8185015835107 L 143.38052204542007 176.17670513852647 L 154.57244676751966 173.5594397524934 L 156.17654953338007 149.67393159599393 L 158.72243120399438 125.87463451068098 L 163.9532337061309 102.54015793946805 L 171.68307707936614 79.88615524533469 L 182.03908438300166 58.325710911873884 L 195.3733245355403 38.474826400935584 L 212.07402874381626 21.38196078947966 L 232.2007197108904 8.544960914619312 L 254.97438440792692 1.394017984402882 L 278.77351698215784 1.8248065864062881 L 301.3676479959142 9.597335992316873 L 321.5643607288115 22.312641521178797 L 339.28782714942804 38.43049441064896 L 354.4241976124638 56.92050691379084 L 366.97168524079143 77.28972532425122 L 376.71420323610755 99.13524604661109 L 383.3049512180381 122.12709286038931 L 386.24089374061185 145.86016546263775 L 384.92788370048225 169.72640915962762 L 380.08161466033835 193.16612790563693 L 396.872711619753 200.37477506251616 L 420.60561931766244 203.09368136442825 L 443.6388733876424 209.58656449260093 L 465.16932624751047 220.04733232344483 L 484.5010435135801 234.1254863285808 L 501.07564609188444 251.3406193495589 L 514.4348751964245 271.1476285194153 L 524.1915416656125 292.96140727469964 L 530.0223703229635 316.1525998776515 L 531.6949111935946 340.0300582220784 L 529.135450319509 363.8298384013482 L 522.5221221955406 386.74596877345516 L 512.0577743789944 408.24150354542456 L 497.9610295884538 427.58823908381135 L 480.67803571779007 444.12330091880756 L 460.77695553143667 457.35547777740913 L 438.88280595793236 466.9180889201476 L 415.6547209796212 472.53219593646975 L 391.7870730769342 473.9991598885471 L 368.0137586613542 471.2283896273047 L 345.10604627238587 464.30079087619333 L 323.6963215180176 453.7103934046146 L 311.78962716533846 457.7104329135833 L 308.12300777021665 481.3421696937762 L 299.65028166917233 503.6872178488818 L 286.7592687188711 523.8019184855104 L 270.05301325583025 540.8910560699371 L 250.26217111999898 554.2800355309274 L 228.18936359224207 563.412951180945 L 204.69439671268998 567.868951808488 L 180.7812779744372 567.4255641109521 L 157.5518791608821 562.2378368777494 L 135.70170122703033 552.4607759756684 L 116.3389089378625 538.3558883826936 L 100.3422180407834 520.5791190721994 L 88.28891919016344 499.9582016033541 L 80.57581232483682 477.3665705841038 L 77.50661267400056 453.6945489713895 L 79.31177257397127 429.8778631723993 L 86.08121262731646 406.92976287534464 L 97.60718434471151 385.9208708771717 L 113.168 367.865" },
  calm: { color: '#FFE136', 
          bg: "#78BEFF",
          moodlabel: "emotions-text/CALM.png",
          path: "M 101.747 364.164 L 78.75347958393121 361.3218028635082 L 56.909832076125404 368.8600369423695 L 38.25896368217287 382.9555013102017 L 19.98491224669126 397.491616491847 L 1.710998418762172 412.02790466387245 L 0 392.22497691505583 L 0 368.8746107420168 L 0 345.52424456761196 L 0 322.1738783939827 L 0 298.8235122209275 L 0 275.47314604649614 L 0 252.1227798729109 L 0 228.7724136998372 L 0 205.42204752538558 L 0 182.07168134039944 L 0 158.72131517248354 L 0 135.37094899296238 L 11.917032745683601 116.05585716785009 L 26.10369997702545 97.50921129508009 L 40.289818013632996 78.9621453393366 L 54.4765637699874 60.415559532863384 L 69.1572927489874 42.30488836657771 L 90.2283443409902 33.18376558638719 L 112.59772026220315 38.363098491627674 L 130.69121369008795 53.085489391281925 L 148.52339378425216 68.16040078507679 L 167.12413243266113 82.13704484441155 L 189.9393587057839 84.69311377666345 L 209.81008190426377 73.19021561967429 L 224.61835288137226 55.1411657983712 L 239.40468310644644 37.06897614364772 L 256.2094506123325 21.15660639144045 L 278.85917352039314 17.422823715849876 L 299.31232162379354 27.866534158225242 L 316.30736869138434 43.8792783205423 L 333.30240310451546 59.89203591336564 L 354.00091423074844 69.82356533548774 L 376.5510624949235 65.50941365581767 L 395.1285388928366 51.40213465834804 L 413.43005827841534 36.90061788863821 L 431.7316307491979 22.39916811485137 L 450.03312361582533 7.897617877225242 L 460 10.63380244785094 L 459.99999999999994 33.98416862154557 L 460 57.33453479524031 L 460 80.68490096893507 L 460 104.03526714262955 L 460 127.38563331632432 L 460 150.73599948977363 L 460 174.08636566382313 L 460 197.43673183752176 L 460 220.78709801094757 L 460 244.13746418475824 L 460 267.48783035872924 L 460.00000000000006 290.8381965321873 L 460.00000000000006 314.188562705882 L 459.99999999999994 337.5389288795765 L 459.99999999999994 360.8892950532713 L 460.00000000000006 384.23966122696606 L 460 407.59002740066074 L 446.57175088253905 424.6681656182702 L 427.0682691108312 437.4762875895437 L 405.5994973672282 446.59220574471743 L 382.6867081490657 449.7072077918158 L 360.1873352489211 444.192140129496 L 341.4252744885884 430.2974046270373 L 327.0567347846707 411.9102839179344 L 313.27812113818305 393.0775281541771 L 295.06699309867594 378.75734412172596 L 272.41244302061875 374.03729915514674 L 249.97632878891136 379.6946794056322 L 232.36497492684492 394.7553931002515 L 217.39575426517436 412.461765235907 L 196.29655539888347 422.00331947302124 L 173.1755671917395 421.3236271954071 L 152.68748642923435 410.5098508272945 L 138.2168656648632 392.3133654251511 L 121.98121912671647 375.5969477319246 L 101.74700000000009 364.16400000000004" },
  tired: { color: '#7C47B2', 
            bg: "#FFAB50",
            moodlabel: "emotions-text/TIRED.png",
            path: "M 143.026 327.285 L 127.85642401452961 336.569812699623 L 111.71501812527053 344.032451587675 L 94.70255303466377 349.3499098157631 L 77.05482563349014 352.0703647233695 L 59.23300027847882 351.62243311875227 L 41.937328415213535 347.3618071961299 L 26.426696208957686 338.8458704901028 L 13.940224793071632 326.07924026845603 L 5.704794191423491 310.42110380493403 L 1.5073816637453592 292.9898293521339 L 0.7520544291536471 275.2882736904194 L 2.62934099783737 257.4178393253707 L 5.945832609408704 240.01544030387527 L 9.932456681125128 222.63344594087627 L 14.544944514585127 205.41155600998292 L 19.790329184926048 188.35703285824275 L 25.676445480083903 171.532010131572 L 32.23856725246311 154.95118309775572 L 39.5124630488948 138.66923402156223 L 47.541902423672525 122.74729087259936 L 56.37651190607179 107.2579860889056 L 66.06954214129786 92.29134606671161 L 76.67419476036665 77.95692722269408 L 88.23756745676265 64.3851766304377 L 100.7935988576037 51.72741566380814 L 114.35354514366753 40.151997386928336 L 128.89419519006572 29.836199927980907 L 144.3239987841518 20.962480728851627 L 160.5635588691899 13.651399865693147 L 177.50190691877594 7.989157265096526 L 194.94057517404002 4.027516865908729 L 212.6222425569393 1.7486354017962458 L 230.36538363636313 1.0970393050509228 L 248.1755489925649 2.232859000550974 L 265.76846890885247 5.245296233587359 L 282.90742534692777 10.115491958010635 L 299.4369783066483 16.761488849505525 L 315.2237141101935 25.04264708953068 L 330.1622720444422 34.77235996088638 L 344.2054891350891 45.7567195197219 L 357.3445989299563 57.808734903320875 L 369.5978790745245 70.76252441854287 L 380.9978487802886 84.47370532438127 L 391.58483535386256 98.82205590203147 L 401.3980946407273 113.70552595697788 L 410.479118209402 129.0479173934254 L 418.86606978411925 144.7938143700721 L 426.5799149262935 160.88385140959036 L 433.615511142187 177.2249605094477 L 440.0006108085074 193.83692964386475 L 445.7455816367177 210.77011551241512 L 450.74845504421376 227.81827334364777 L 455.00058973178994 245.25416795379948 L 458.19243836429047 262.76029053582 L 459.708251399853 280.52799534643793 L 459.4538478174615 298.3511609852443 L 457.3763217960561 316.053805907932 L 453.2855767009755 333.40175941763823 L 446.85462560793246 350.0109996472116 L 437.62938354268977 365.2560088913683 L 425.2585573911403 378.01588026269656 L 409.87878400348876 386.93353462651544 L 392.61178592613237 391.17871529354943 L 374.8215398551275 392.1654108284766 L 357.0779169486148 390.53461646922744 L 339.71859895324235 386.50266008862195 L 322.99556520583747 380.3379193361018 L 307.0829435505567 372.30591269236777 L 292.10490498160175 362.6388904026343 L 278.1627339823883 351.5301628722963 L 265.3524691697601 339.1326923657734 L 253.7709287739329 325.6036832068033 L 241.15281538314238 313.0035366332125 L 225.74007362733568 304.209393123819 L 208.25509224271502 301.1139280345484 L 190.68627360342418 303.4543066443619 L 173.8718310980005 309.4663487177497 L 158.07783737736145 317.6645923977287 L 143.02599999999995 327.2850000000001" },
  sad: { color: '#47A0F3', 
          bg: "#8AF5FF",
          moodlabel: "emotions-text/SAD.png",
          path: "M 125.01 36.565 L 139.05516115531847 42.701335912395734 L 153.10035792281724 48.83759030997662 L 167.14551000809715 54.9739469805749 L 181.19038049316467 61.110948144698504 L 195.23545114397066 67.24749120625822 L 209.2806746747989 73.38368434574613 L 223.32580729820032 79.520085560453 L 237.37083267718373 85.65673223366824 L 251.41598863746543 91.79308003334775 L 265.46111663916207 97.92949182646868 L 279.50614232335016 104.06613780116359 L 293.55129068712915 110.20250298780316 L 307.596457536368 116.3388258686484 L 321.64165399407824 122.47508097542539 L 335.6867716562185 128.61151642903008 L 349.7317014056793 134.74838196165288 L 363.7768154304413 140.8848257494135 L 375.4881499764387 148.05153149697972 L 370.80658028737736 162.66844353702706 L 366.26560138246 177.29364812119945 L 361.7157544333731 191.93471966697035 L 357.06996785588206 206.54548599893667 L 352.25889120117125 221.08941747891208 L 347.2117040089042 235.56702235623706 L 341.87436553743123 249.93378053611224 L 336.1852359436373 264.1638454517187 L 330.0787997976315 278.2213117636202 L 323.4874216063157 292.0577703885062 L 316.33394780332196 305.61176901121434 L 308.53469388802233 318.80380695145453 L 299.9964265838012 331.52999929317406 L 290.62277506606097 343.65249255171534 L 280.320517403692 354.99366929509847 L 269.0117208827138 365.33091798411044 L 256.66522404437956 374.3983381443107 L 243.32017307513698 381.9162060355636 L 229.11561803263456 387.634705911286 L 214.27304041758538 391.4011749420765 L 199.04231835966027 393.1996465048154 L 183.73443471376947 393.2514118433103 L 168.44209820734284 392.2467907216613 L 153.247259600545 390.25860624665785 L 138.21846506177732 387.2671738385189 L 123.42892186835469 383.25125100649325 L 108.96649115480767 378.1908702642436 L 94.92086054792553 372.06351451749833 L 81.39870830526345 364.8533413966827 L 68.52001098001885 356.55348729074916 L 56.409083854499734 347.16764067109216 L 45.20117407499957 336.7208568361052 L 35.031532450551964 325.26151235993063 L 26.02659700974447 312.8666038790793 L 18.293408220883606 299.6397292887432 L 11.909928035475668 285.71528428267555 L 6.910108718013726 271.2269058639352 L 3.302665378573412 256.3580292234647 L 1.0377367149802397 241.1978676639385 L 0.05599857125496145 225.873385456775 L 0.2736346637061364 210.5657283544561 L 1.2263833068626668 195.27556552082 L 2.4001892456957274 179.99718310330772 L 3.8359029409261964 164.72447414591647 L 5.583622961892063 149.47582331142894 L 7.696142242929486 134.32204846569516 L 10.24543474494326 119.22680014856944 L 13.289630488950454 104.21793168150313 L 16.862830736636223 89.26635630075731 L 20.87737936482416 74.49639701426192 L 25.190370723680353 59.789152306357785 L 29.550162560485937 45.13018578221684 L 33.769256431743344 30.332723415669065 L 37.648061020594625 15.563138996650597 L 41.185757877093195 0.602524470181591 L 54.78456107626998 5.882480820036694 L 68.82972374861785 12.018813274522234 L 82.87484929294968 18.15523068492021 L 96.91971817857824 24.292235508704003 L 110.9647814829542 30.428795383785562 L 125.0100000000001 36.56500000000003" },
  anxious: { color: '#00D78F', 
            bg:"#98FFCD",
            moodlabel: "emotions-text/ANXIOUS.png",
            path: "M 66.423 507.258 L 59.908603027632125 485.7163332913074 L 53.39414695897729 464.1746844548993 L 46.879930765697004 442.63296307964356 L 40.36585037848298 421.0912006354344 L 33.851614240162746 399.54948529031293 L 27.33749411722441 378.0077348619464 L 20.823325208436394 356.46599918842384 L 14.309108674075492 334.92427791480975 L 7.794959344948667 313.3825363184749 L 1.2806685647290397 291.84083749699886 L 8.584388785070967 271.6929072905185 L 19.26896054396545 251.88582020767257 L 29.953686616391916 232.07881636668145 L 40.637956405647024 212.2715663970055 L 51.3226090696339 192.46452294562224 L 62.00737873265735 172.65754262921396 L 72.69229878415487 152.85064342765693 L 83.37721883565241 133.04374422609993 L 94.06212557170751 113.2368378418624 L 104.74631428267433 93.42954413333553 L 115.43120439559007 73.62262878180911 L 126.1161244470876 53.815729580252075 L 141.0484370616551 42.317224753505485 L 163.36089528975705 45.255758421771894 L 185.67332038683935 48.19454351972542 L 207.98582053583237 51.13275894158318 L 230.29834593304955 54.07078256568714 L 252.6108448932513 57.009006916229716 L 274.9233223463069 59.94739463537266 L 297.2358071161369 62.88572676931089 L 319.5483272488543 65.82379038190527 L 341.8608274533652 68.76200533134869 L 364.1733182014048 71.70029209924549 L 386.4858105685876 74.63856656456953 L 408.798302190767 77.57684669183624 L 430.007727925674 82.21043967560017 L 441.73296802679397 101.41979981677014 L 453.4581422121395 120.62920018571499 L 465.18318894116965 139.8386783625177 L 476.90846529370873 159.048016374675 L 488.63376528366007 178.25733996043243 L 500.3590394460933 197.466679311848 L 512.0841972269668 216.67608970073903 L 523.8094477928355 235.88544345496723 L 535.5347854924961 255.09474402309164 L 547.2601608191536 274.3040216236536 L 558.98552426599 293.51330647568517 L 570.7108263261947 312.72262879806334 L 582.4360174929938 331.93201880886454 L 569.9192383693525 349.8213302241274 L 556.1774935887274 367.64393449150936 L 542.4357488081023 385.46653875889103 L 528.6943855312898 403.2894371673401 L 514.9531584334218 421.11244057099657 L 501.21193427501817 438.935446241657 L 487.47061738056306 456.7583804120693 L 473.7290383316972 474.5811124621786 L 459.9873712561856 492.40377664217743 L 446.24566416490217 510.22640996906136 L 432.50396506859727 528.0490494602766 L 418.7623219780461 545.871732133179 L 405.0207829041968 563.6944950044965 L 383.3503358357787 565.3920000000002 L 360.8452081425721 565.392 L 338.34008044936564 565.392 L 315.83495275615917 565.3920000000002 L 293.3298250629523 565.392 L 270.82469736974576 565.392 L 248.31956967653926 565.3920000000002 L 225.8144419833327 565.392 L 203.30931429012594 565.3919999999999 L 180.80418659691946 565.3920000000002 L 158.29905890371293 565.392 L 135.79393121050637 565.392 L 113.28880351729961 565.392 L 90.78367582409308 565.392 L 79.45094305160347 550.3415907254063 L 72.93697152580175 528.7997953627032 L 66.42299999999997 507.25799999999987" },
  angry: { color: '#EC4F2C', 
            bg: "#830000",
            moodlabel: "emotions-text/ANGRY.png",
            path: "M 207 429.333 L 182.4990478771672 456.2839805835624 L 157.9981702163375 483.2350288599714 L 133.49732069965182 510.18610272164267 L 108.9964530083156 537.1371600611363 L 84.49552082413855 564.0881587709189 L 79.222 541.3053944007999 L 79.222 504.88215992938774 L 79.222 468.45892545824836 L 79.222 432.035690987207 L 79.222 395.61245651589815 L 79.222 359.1892220445854 L 51.876987573203486 350.111 L 15.453753102254879 350.111 L 14.590424237061844 335.0498357190554 L 39.933463467562966 308.8891329031267 L 65.27650234184028 282.7284297413991 L 75.93504070721323 252.28552346795317 L 68.626845896152 216.6030025717076 L 61.31863074920069 180.92048584291717 L 54.00978050979177 145.23809918793907 L 46.7015859689583 109.55557823634793 L 39.39339144178544 73.87305728195894 L 47.937212039796826 70.03952653040427 L 71.99933734926533 97.383010853567 L 96.06156621824775 124.72640404460722 L 120.12377405726937 152.06981574201933 L 144.18583627666013 179.41335558395238 L 157.44651269350805 155.12403654303895 L 168.53017999024138 120.42815309080217 L 179.61314741562146 85.73204607027937 L 190.69642335117047 51.03603760007168 L 201.78006507103555 16.340145976314144 L 210.84614723129755 18.881832725686955 L 218.11611217302175 54.572162215474954 L 225.38671930850995 90.26236088255584 L 232.65699710448916 125.95262664348877 L 254.2155235420518 123.26229171909472 L 283.05480694204977 101.01487069265748 L 311.89406334848076 78.7674146747747 L 340.7333115193647 56.51994798136457 L 369.5725702129908 34.272494928324065 L 398.41185818730514 12.025079831576786 L 407.13225584254496 15.261818471166947 L 392.1853565634471 48.47690858519344 L 377.2384301347198 81.69198648176263 L 362.2917420697849 114.90717164191899 L 347.344859205654 148.12226914273424 L 332.397922634412 181.3373424751137 L 332.8978335648648 202.41648391405533 L 368.70664224709543 195.75456000707 L 404.51546490974783 189.0927112522503 L 427.0644075082305 191.09503884364594 L 406.58328259746406 221.2143936134407 L 386.1020929657301 251.3337043725465 L 365.6209116919265 281.4530208151947 L 345.1398118549928 311.5723926349142 L 381.17459468500437 311.77799999999996 L 417.5978291557826 311.778 L 454.021063627457 311.7780000000001 L 431.1180152002837 321.4053693563507 L 396.5638232948551 332.9231743164426 L 362.00965375815474 344.44104638441013 L 358.665923330717 362.57096483113094 L 385.58109812947174 387.1112454917361 L 412.49625403586685 411.651546872803 L 421.70909574306904 429.33299999999997 L 385.28586127140807 429.33299999999997 L 348.86262680060474 429.333 L 312.4393923289789 429.3330000000001 L 317.6001385657837 457.9676050280235 L 330.592126086936 491.9949509367711 L 343.5840803483886 526.0223095443597 L 356.576149949225 560.0496241141374 L 341.2472636609677 552.3938484915726 L 314.39777564700927 527.7817172811547 L 287.548221000513 503.1696587601441 L 260.69893905535685 478.5573027508127 L 233.84939271824123 453.9452351688174 L 207.00000000000006 429.3330000000001" },
};

  // Date display and submission flow
  function updateDateDisplay() {
    const today = new Date();
    const options = { month: 'long', day: 'numeric' };
    const dateString = today.toLocaleDateString('en-US', options).toUpperCase();
    document.getElementById('dateDisplay').textContent = dateString;
  }

  function showNoteInput() {
    document.getElementById('submitButton').style.display = 'none';
    document.getElementById('darkOverlay').style.display = 'block';
    document.getElementById('noteInput').style.display = 'block';
    document.getElementById('confirmButton').style.display = 'block';
    document.getElementById('closeButton').style.display = 'flex';
    document.getElementById('noteInput').focus();
  }

  function hideNoteInput() {
    document.getElementById('submitButton').style.display = 'block';
    document.getElementById('darkOverlay').style.display = 'none';
    document.getElementById('noteInput').style.display = 'none';
    document.getElementById('confirmButton').style.display = 'none';
    document.getElementById('closeButton').style.display = 'none';
    document.getElementById('noteInput').value = '';
  }

  function saveMoodEntry() {
    const today = new Date();
    const dateKey = today.toISOString().split('T')[0]; // YYYY-MM-DD format
    const note = document.getElementById('noteInput').value.trim();
    
    const moodEntry = {
      mood: moods[currentIndex],
      note: note || '',
      timestamp: today.getTime(),
      date: dateKey
    };

    // Save to localStorage
    const existingData = JSON.parse(localStorage.getItem('moodData') || '{}');
    existingData[dateKey] = moodEntry;
    localStorage.setItem('moodData', JSON.stringify(existingData));

    // Apply dynamic theme based on mood
    applyMoodTheme(moodEntry.mood);

    // Show toast notification
    showToast('mood entry submitted');

    // Hide note input and navigate to calendar
    hideNoteInput();
    
    // Navigate to calendar view
    showCalendar();
    
    console.log('Saved mood entry:', moodEntry);
    console.log('All mood data:', existingData);
  }

  // Toast notification function
  function showToast(message) {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    
    toastMessage.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }

  // Dynamic theming function
  function applyMoodTheme(moodName) {
    const moodInfo = moodPaths[moodName];
    if (moodInfo) {
      // Update CSS variables
      document.documentElement.style.setProperty('--page-bg', moodInfo.bg);
      document.documentElement.style.setProperty('--page-text', moodInfo.color);
      document.documentElement.style.setProperty('--page-stroke', moodInfo.color);
      
      // Store current theme in localStorage
      localStorage.setItem('currentTheme', JSON.stringify({
        bg: moodInfo.bg,
        text: moodInfo.color,
        stroke: moodInfo.color,
        mood: moodName
      }));
      
      // Force layout recalculation to fix positioning issues
      setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
      }, 100);
    }
  }

  // Load saved theme on page load
  function loadSavedTheme() {
    const savedTheme = localStorage.getItem('currentTheme');
    if (savedTheme) {
      const theme = JSON.parse(savedTheme);
      document.documentElement.style.setProperty('--page-bg', theme.bg);
      document.documentElement.style.setProperty('--page-text', theme.text);
      document.documentElement.style.setProperty('--page-stroke', theme.stroke);
      
      // Force layout recalculation to fix positioning issues
      setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
      }, 100);
    }
  }

  // Event listeners for submission flow
  document.getElementById('submitButton').addEventListener('click', showNoteInput);
  document.getElementById('confirmButton').addEventListener('click', saveMoodEntry);
  document.getElementById('closeButton').addEventListener('click', hideNoteInput);
  document.getElementById('darkOverlay').addEventListener('click', hideNoteInput);
  
  // Event listeners for calendar
  document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
  document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
  document.getElementById('backToMood').addEventListener('click', hideCalendar);
  
  // Event listener for date display - navigate to calendar
  document.getElementById('dateDisplay').addEventListener('click', showCalendar);
  
  // Event listener for full-screen date display - navigate back to calendar
  document.getElementById('moodDetailsFullDate').addEventListener('click', hideMoodDetailsFull);
  
  // Event listeners for mood details modal
  document.getElementById('closeMoodDetails').addEventListener('click', hideMoodDetails);
  document.getElementById('moodDetailsOverlay').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      hideMoodDetails();
    }
  });
  
  // Event listeners for full-screen mood details
  document.getElementById('closeMoodDetailsFull').addEventListener('click', hideMoodDetailsFull);
  document.getElementById('moodDetailsFullScreen').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      hideMoodDetailsFull();
    }
  });

  // Event listeners for share functionality
  document.getElementById('shareMoodButton').addEventListener('click', showShareModal);
  document.getElementById('closeShareModal').addEventListener('click', hideShareModal);
  document.getElementById('shareModal').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      hideShareModal();
    }
  });
  document.getElementById('downloadGif').addEventListener('click', downloadGif);
  document.getElementById('copyGifLink').addEventListener('click', copyGifLink);
  
  // Allow Enter key to confirm note (Ctrl+Enter or just Enter)
  document.getElementById('noteInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      saveMoodEntry();
    }
  });

  // Update UI colors based on current mood
  function updateMoodColors() {
    if (!moods || !moodPaths || currentIndex === undefined) return;
    
    const currentMood = moods[currentIndex];
    const moodData = moodPaths[currentMood];
    
    if (!moodData) return;
    
    // Update date display colors
    const dateDisplay = document.getElementById('dateDisplay');
    if (dateDisplay) {
      dateDisplay.style.borderColor = moodData.color;
      dateDisplay.style.color = moodData.color;
    }
    
    // Update submit button colors
    const submitButton = document.getElementById('submitButton');
    if (submitButton) {
      submitButton.style.borderColor = moodData.color;
      submitButton.style.color = moodData.bg;
      submitButton.style.backgroundColor = moodData.color;
    }
  }

  // Initialize date display
  updateDateDisplay();

  // Calendar functionality
  let currentCalendarDate = new Date();
  
  function showCalendar() {
    document.getElementById('background').style.display = 'none';
    document.getElementById('calendarView').style.display = 'block';
    generateCalendar();
  }
  
  function hideCalendar() {
    document.getElementById('background').style.display = 'block';
    document.getElementById('calendarView').style.display = 'none';
  }
  
  function generateCalendar() {
    const year = currentCalendarDate.getFullYear();
    const month = currentCalendarDate.getMonth();
    
    // Update month header
    const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE",
                       "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
    const monthNamesShort = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    
    // Update new header elements
    document.getElementById('calendarMonthNumber').textContent = String(month + 1).padStart(2, '0');
    document.getElementById('calendarYear').textContent = year;
    document.getElementById('calendarMonthName').textContent = monthNamesShort[month];
    
    // Clear calendar grid
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    
    // Add day headers
    const dayHeaders = ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'];
    dayHeaders.forEach(day => {
      const header = document.createElement('div');
      header.textContent = day;
      header.className = 'calendar-day-header';
      grid.appendChild(header);
    });
    
    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Convert Sunday=0 to Monday=0
    
    // Add empty cells for days before month starts
    for (let i = 0; i < startingDayOfWeek; i++) {
      const emptyDay = document.createElement('div');
      emptyDay.className = 'calendar-day empty';
      grid.appendChild(emptyDay);
    }
    
    // Add days of the month
    const today = new Date();
    const moodData = JSON.parse(localStorage.getItem('moodData') || '{}');
    
    for (let day = 1; day <= daysInMonth; day++) {
      const dayElement = document.createElement('div');
      dayElement.className = 'calendar-day';
      
      // Add day number
      const dayNumber = document.createElement('span');
      dayNumber.className = 'day-number';
      dayNumber.textContent = day;
      dayElement.appendChild(dayNumber);
      
      const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      
      // Check if this is today
      if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
        dayElement.classList.add('today');
      }
      
      // Check if there's mood data for this day
      if (moodData[dateKey]) {
        dayElement.classList.add('has-mood');
        
        // Set background color to mood's color
        const moodInfo = moodPaths[moodData[dateKey].mood];
        dayElement.style.background = moodInfo.bg;
        
        // Set day number color to mood's dot color
        dayNumber.style.color = moodInfo.color;
        
        // Add mood PNG
        const moodPng = document.createElement('img');
        moodPng.className = 'mood-png';
        moodPng.src = `PNGs/${moodData[dateKey].mood}.png`;
        moodPng.alt = moodData[dateKey].mood;
        dayElement.appendChild(moodPng);
        
        // Add mood indicator (small colored dot)
        const indicator = document.createElement('div');
        indicator.className = 'mood-indicator';
        dayElement.appendChild(indicator);
        
        // Add click handler to show mood details
        dayElement.addEventListener('click', () => showMoodDetails(dateKey, moodData[dateKey]));
      }
      
      grid.appendChild(dayElement);
    }
  }
  
  // Full-screen Paper.js setup
  let fullScreenPaper = null;
  let fullScreenCurrent = null;
  let fullScreenOriginalPoints = null;
  let fullScreenWigglePhase = 0;
  let fullScreenIsWiggling = true;
  let currentFullScreenMood = null;
  
  function setupFullScreenPaper() {
    console.log('ðŸ“ setupFullScreenPaper called');
    const canvas = document.getElementById('moodCanvasFull');
    console.log('ðŸŽ¯ Canvas element:', canvas);
    console.log('ðŸ“ Canvas initial size:', canvas.width, 'x', canvas.height);
    
    fullScreenPaper = new paper.PaperScope();
    fullScreenPaper.setup(canvas);
    console.log('âš™ï¸ Paper setup complete');
    
    // Resize canvas
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    console.log('ðŸ“ Canvas resized to:', canvas.width, 'x', canvas.height);
    
    fullScreenPaper.view.viewSize = new paper.Size(canvas.width, canvas.height);
    console.log('ðŸ“ Paper view size set to:', fullScreenPaper.view.viewSize);
    console.log('ðŸŽ¯ Paper view center:', fullScreenPaper.view.center);
    
    // Animation loop
    fullScreenPaper.view.onFrame = (event) => {
      if (!fullScreenIsWiggling || !fullScreenCurrent) return;
      fullScreenWigglePhase += event.delta * 10;
      fullScreenCurrent.firstChild.segments.forEach((seg, i) => {
        const original = fullScreenOriginalPoints[i];
        const offset = Math.sin(fullScreenWigglePhase + i * 0.5) * 2;
        seg.point.y = original.y + offset;
      });
    };
  }
  
  function createFullScreenMoodShape(moodName) {
    console.log('ðŸŽ¨ createFullScreenMoodShape called with:', moodName);
    
    if (!fullScreenPaper) {
      console.log('ðŸ“ Setting up full screen paper...');
      setupFullScreenPaper();
    }
    
    // Store the current mood for resize recreation
    currentFullScreenMood = moodName;
    console.log('ðŸ’¾ Stored current mood:', currentFullScreenMood);
    
    const moodData = moodPaths[moodName];
    console.log('ðŸ“Š Mood data:', moodData);
    
    const path = new fullScreenPaper.CompoundPath(moodData.path);
    path.fillColor = moodData.color;
    path.position = fullScreenPaper.view.center;
    console.log('ðŸ“ Path position set to:', path.position);
    
    // Scale the shape
    const scaleFactor = Math.min(
      window.innerWidth / 1000,
      window.innerHeight / 1000
    );
    console.log('ðŸ“ Scale factor calculated:', scaleFactor);
    console.log('Window dimensions:', window.innerWidth, 'x', window.innerHeight);
    
    path.scale(scaleFactor);
    path.scalingFactor = scaleFactor;
    console.log('ðŸ” Path scaled, new bounds:', path.bounds);
    
    fullScreenCurrent = path;
    fullScreenOriginalPoints = path.firstChild.segments.map(seg => seg.point.clone());
    fullScreenIsWiggling = true;
    console.log('âœ… Shape creation complete');
  }

  function showMoodDetails(dateKey, moodEntry) {
    const moodData = moodPaths[moodEntry.mood];
    
    // Store current mood data for sharing
    window.currentMoodData = {
      mood: moodEntry.mood,
      date: dateKey,
      formattedDate: new Date(dateKey).toLocaleDateString('en-US', { 
        month: 'long', 
        day: 'numeric' 
      }).toUpperCase()
    };
    
    // Format the date like "AUGUST 19"
    const date = new Date(dateKey);
    const formattedDate = date.toLocaleDateString('en-US', { 
      month: 'long', 
      day: 'numeric' 
    }).toUpperCase();
    
    // Set the background color to match the mood
    document.getElementById('moodDetailsFullScreen').style.background = moodData.bg;
    
    // Update date display with mood color
    const dateElement = document.getElementById('moodDetailsFullDate');
    dateElement.textContent = formattedDate;
    dateElement.style.borderColor = moodData.color;
    dateElement.style.color = moodData.color;
    
    // Create the animated mood shape
    createFullScreenMoodShape(moodEntry.mood);
    
    // Update mood label
    document.getElementById('moodLabelFull').src = moodData.moodlabel;
    
    // Update face video
    const faceVid = document.getElementById('moodFaceFull');
    const facePath = `faces/${moodEntry.mood}.webm`;
    fetch(facePath).then(res => {
      if (res.ok) {
        faceVid.src = facePath;
        faceVid.style.display = 'block';
      } else {
        faceVid.style.display = 'none';
      }
    });
    
    // Update note
    const noteElement = document.getElementById('moodDetailsFullNote');
    noteElement.textContent = moodEntry.note || 'No note added for this day.';
    noteElement.style.color = moodData.color;
    
    // Hide calendar and show full-screen mood details view
    document.getElementById('calendarView').style.display = 'none';
    document.getElementById('moodDetailsFullScreen').style.display = 'flex';
  }
  
  function hideMoodDetails() {
    document.getElementById('moodDetailsOverlay').style.display = 'none';
  }
  
  function hideMoodDetailsFull() {
    // Clean up full-screen Paper.js
    if (fullScreenPaper && fullScreenCurrent) {
      fullScreenCurrent.remove();
      fullScreenCurrent = null;
      fullScreenOriginalPoints = null;
      fullScreenIsWiggling = false;
    }
    
    document.getElementById('moodDetailsFullScreen').style.display = 'none';
    document.getElementById('calendarView').style.display = 'block';
  }

  // Share functionality
  let currentSharedMood = null;
  let currentSharedDate = null;

  function showShareModal() {
    // Get the current mood and date from the day view
    const moodData = getCurrentMoodData();
    if (!moodData) return;

    currentSharedMood = moodData.mood;
    currentSharedDate = moodData.date;

    // Set the GIF source (you'll need to create these GIFs)
    const gifSrc = `share-gifs/${currentSharedMood}-500x500.gif`;
    document.getElementById('shareGif').src = gifSrc;

    // Update social media sharing links
    updateSocialMediaLinks();

    // Show the modal
    document.getElementById('shareModal').style.display = 'flex';
  }

  function hideShareModal() {
    document.getElementById('shareModal').style.display = 'none';
  }

  function getCurrentMoodData() {
    // This function should return the current mood data from the day view
    // We'll need to store this when the day view is opened
    return window.currentMoodData || null;
  }

    function updateSocialMediaLinks() {
      if (!currentSharedMood || !currentSharedDate) return;

      const moodName = currentSharedMood.charAt(0).toUpperCase() + currentSharedMood.slice(1);
      const shareText = `I'm feeling ${moodName} today! ðŸŽ¨`;
      const shareUrl = `https://allanmacdonalddesign.github.io/mood-app/?mood=${currentSharedMood}&date=${currentSharedDate}&share=true`;
      
      // LinkedIn
      const linkedInUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`;
      document.getElementById('shareLinkedIn').href = linkedInUrl;
      
      // Facebook
      const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
      document.getElementById('shareFacebook').href = facebookUrl;
      
      // Twitter
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;
      document.getElementById('shareTwitter').href = twitterUrl;
    }

  function downloadGif() {
    if (!currentSharedMood) return;

    const gifSrc = `share-gifs/${currentSharedMood}-500x500.gif`;
    const link = document.createElement('a');
    link.href = gifSrc;
    link.download = `mood-${currentSharedMood}-${currentSharedDate}.gif`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function copyGifLink() {
    if (!currentSharedMood) return;

    const gifUrl = `https://allanmacdonalddesign.github.io/mood-app/share-gifs/${currentSharedMood}-500x500.gif`;
    
    // Copy to clipboard
    navigator.clipboard.writeText(gifUrl).then(() => {
      // Show feedback
      const button = document.getElementById('copyGifLink');
      const originalText = button.textContent;
      button.textContent = 'Copied!';
      button.style.background = '#4CAF50';
      
      setTimeout(() => {
        button.textContent = originalText;
        button.style.background = '';
      }, 2000);
    }).catch(err => {
      console.error('Failed to copy: ', err);
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = gifUrl;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      
      const button = document.getElementById('copyGifLink');
      const originalText = button.textContent;
      button.textContent = 'Copied!';
      setTimeout(() => {
        button.textContent = originalText;
      }, 2000);
    });
  }
  
  function changeMonth(direction) {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
    generateCalendar();
  }

  
  function makePath(d, color) {
    const path = new paper.CompoundPath(d);
    path.fillColor = color;
    path.position = paper.view.center;
    return path;
  }
  
  let moods = Object.keys(moodPaths);
  let currentIndex = 0;
  let current = makePath(moodPaths[moods[currentIndex]].path, moodPaths[moods[currentIndex]].color);
  document.getElementById('background').style.background = moodPaths[moods[currentIndex]].bg;
  document.getElementById('moodLabel').src = moodPaths[moods[currentIndex]].moodlabel;
  
  // Update button colors immediately with background
  const currentMood = moods[currentIndex];
  const moodData = moodPaths[currentMood];
  
  // Update date display colors
  const dateDisplay = document.getElementById('dateDisplay');
  if (dateDisplay) {
    dateDisplay.style.borderColor = moodData.color;
    dateDisplay.style.color = moodData.color;
  }
  
  // Update submit button colors
  const submitButton = document.getElementById('submitButton');
  if (submitButton) {
    submitButton.style.borderColor = moodData.color;
    submitButton.style.color = moodData.bg;
    submitButton.style.backgroundColor = moodData.color;
  }
  // document.getElementById('moodFace').src = `faces/${moods[nextIndex]}.webm`;


  let originalPoints = current.firstChild.segments.map(seg => seg.point.clone());
  let wigglePhase = 0;
  let isWiggling = true;
  let isMorphing = false;
  
  paper.view.onFrame = (event) => {
    if (!isWiggling || isMorphing) return;
    wigglePhase += event.delta * 10;
    current.firstChild.segments.forEach((seg, i) => {
      const original = originalPoints[i];
      const offset = Math.sin(wigglePhase + i * 0.5) * 2;
      seg.point.y = original.y + offset;
    });
  };

// Update face video
const faceVid = document.getElementById('moodFace');
const facePath = `faces/${moods[currentIndex]}.webm`;
fetch(facePath).then(res => {
  if (res.ok) {
    faceVid.src = facePath;
    faceVid.style.display = 'block';
  } else {
    faceVid.style.display = 'none';
  }
});


  
  function resetToOriginalPoints() {
    current.firstChild.segments.forEach((seg, i) => {
      seg.point = originalPoints[i].clone();
    });
  }
  const slider = document.getElementById('moodSlider');

  moods.forEach((mood, index) => {
  const dot = document.createElement('div');
  dot.classList.add('slider-dot');
  if (index === currentIndex) dot.classList.add('active');

  // ðŸ‘‡ Set the correct background color on load
  dot.style.background = index === currentIndex
    ? moodPaths[mood].color
    : 'rgba(0,0,0,0.1)';

  dot.addEventListener('click', () => {
    if (index !== currentIndex && !isMorphing) {
      morphTo(index);
      updateSlider(index);
      currentIndex = index;
    }
  });

  slider.appendChild(dot);
});

function updateSlider(activeIndex) {
  document.querySelectorAll('.slider-dot').forEach((dot, i) => {
    dot.classList.toggle('active', i === activeIndex);
    dot.style.background = i === activeIndex ? moodPaths[moods[activeIndex]].color : 'rgba(0,0,0,0.1)';
  });
  thumb.style.background = moodPaths[moods[activeIndex]].color;
}

// --- DRAGGABLE MOOD THUMB CODE ---
const thumb = document.getElementById('moodThumb');
// const dots = document.querySelectorAll('.slider-dot');
let isDragging = false;
let trackRect;

function updateThumbPosition(index) {
  const dots = document.querySelectorAll('.slider-dot'); // â† new fresh query
  const dot = dots[index];
  const rect = dot.getBoundingClientRect();
  const sliderRect = slider.getBoundingClientRect();
  const dotCenterX = rect.left + rect.width / 2;
  const sliderLeft = sliderRect.left;
  const percent = (dotCenterX - sliderLeft) / sliderRect.width;
  thumb.style.left = `${percent * 100}%`;
}

updateThumbPosition(currentIndex); // Set thumb to initial mood
thumb.style.background = moodPaths[moods[currentIndex]].color;


slider.addEventListener('mousedown', (e) => {
  isDragging = true;
  trackRect = slider.getBoundingClientRect();
});

document.addEventListener('mousemove', (e) => {
  if (!isDragging) return;
  const x = e.clientX - trackRect.left;
  const clampedX = Math.max(0, Math.min(trackRect.width, x));
  const percent = clampedX / trackRect.width;
  thumb.style.left = `${percent * 100}%`;

  thumb.style.transform = 'translate(-50%, -50%) scale(1.3, 0.7)';
});

document.addEventListener('mouseup', (e) => {
  if (!isDragging) return;
  isDragging = false;
  thumb.style.transform = 'translate(-50%, -50%) scale(1, 1)';

  const dots = document.querySelectorAll('.slider-dot');
  const x = e.clientX - trackRect.left;

  let closestIndex = 0;
  let minDistance = Infinity;
  dots.forEach((dot, i) => {
    const rect = dot.getBoundingClientRect();
    const center = rect.left + rect.width / 2 - trackRect.left;
    const distance = Math.abs(x - center);
    if (distance < minDistance) {
      minDistance = distance;
      closestIndex = i;
    }
  });

  updateThumbPosition(closestIndex);
  updateSlider(closestIndex);


  if (closestIndex !== currentIndex && !isMorphing) {
    morphTo(closestIndex);
    updateSlider(closestIndex);
    currentIndex = closestIndex;
  }
});



  function rotateSegments(segments, shift) {
  const len = segments.length;
  return segments.map((_, i) => segments[(i + shift) % len].point.clone());
}

function morphTo(nextIndex, duration = 400) {
  isMorphing = true;
  isWiggling = false;
  resetToOriginalPoints();

  const nextMood = moods[nextIndex];
  const nextPath = new paper.CompoundPath(moodPaths[nextMood].path);
  nextPath.position = paper.view.center;
  nextPath.scale(current.scalingFactor || 1);


  const fromSegs = current.firstChild.segments;
  const toSegs = nextPath.firstChild.segments;

  // Rotate alignment
  let bestOffset = 0;
  let minDistance = Infinity;
  for (let offset = 0; offset < toSegs.length; offset++) {
    const rotated = rotateSegments(toSegs, offset);
    const total = rotated.reduce((sum, pt, i) => sum + pt.getDistance(fromSegs[i].point), 0);
    if (total < minDistance) {
      minDistance = total;
      bestOffset = offset;
    }
  }

  const targetPoints = rotateSegments(toSegs, bestOffset);
  const steps = 60;
  let frame = 0;

  const deltaPoints = fromSegs.map((seg, i) =>
    targetPoints[i].subtract(seg.point).divide(steps)
  );

  // Change background + text + button colors immediately
  document.getElementById('background').style.background = moodPaths[nextMood].bg;
  document.getElementById('moodLabel').src = `emotions-text/${moods[nextIndex].toUpperCase()}.png`;
  
  // Update button colors immediately with background
  const moodData = moodPaths[nextMood];
  
  // Update date display colors
  const dateDisplay = document.getElementById('dateDisplay');
  if (dateDisplay) {
    dateDisplay.style.borderColor = moodData.color;
    dateDisplay.style.color = moodData.color;
  }
  
  // Update submit button colors
  const submitButton = document.getElementById('submitButton');
  if (submitButton) {
    submitButton.style.borderColor = moodData.color;
    submitButton.style.color = moodData.bg;
    submitButton.style.backgroundColor = moodData.color;
  }


  const facePath = `faces/${moods[nextIndex]}.webm`;
fetch(facePath).then(res => {
  if (res.ok) {
    faceVid.src = facePath;
    faceVid.style.display = 'block';
  } else {
    faceVid.style.display = 'none';
  }
});

  const interval = setInterval(() => {
    for (let i = 0; i < fromSegs.length; i++) {
      fromSegs[i].point = fromSegs[i].point.add(deltaPoints[i]);
    }
    current.fillColor = moodPaths[nextMood].color;
    frame++;
    if (frame >= steps) {
      clearInterval(interval);
      nextPath.remove();
      originalPoints = fromSegs.map(seg => seg.point.clone());
      isMorphing = false;
      isWiggling = true;
      updateMoodColors();
    }
  }, duration / steps);
}

function resizeCanvas() {
  const canvas = document.getElementById('moodCanvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  paper.view.viewSize = new paper.Size(canvas.width, canvas.height);


  if (current) {
    // Reset shape scale before applying new scale
    current.scale(1 / (current.scalingFactor || 1)); // Prevent NaN on first run

    // Recalculate scale based on target width
    const shapeOriginalWidth = 1000; // â† match your design
    const shapeOriginalHeight = 1000;

    const scaleFactor = Math.min(
      canvas.width / shapeOriginalWidth,
      canvas.height / shapeOriginalHeight
    );

    current.scale(scaleFactor);
    current.scalingFactor = scaleFactor;

    current.position = paper.view.center;

    // Update original points so wiggle animation works after scaling
    originalPoints = current.firstChild.segments.map(seg => seg.point.clone());
    
  }

  // Update moodFace scaling & positioning
  const face = document.getElementById('moodFace');
  face.style.left = '50%';
  face.style.top = '50%';

  const scaleForVideo = Math.min(window.innerWidth / 1000, 1);
  face.style.transform = `translate(-50%, -50%) scale(${scaleForVideo})`;
}


// Handle main page resize - Real-time approach
let isMainPageResizing = false;
let mainPageResizeTimeout;

function handleMainPageResize() {
  // Update the main canvas size
  const canvas = document.getElementById('moodCanvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  paper.view.viewSize = new paper.Size(canvas.width, canvas.height);
  
  // Recreate the current mood shape fresh (same approach as full-screen)
  if (current && moods[currentIndex]) {
    const currentMood = moods[currentIndex];
    const moodData = moodPaths[currentMood];
    
    // Clear and recreate the shape
    paper.project.clear();
    const path = new paper.CompoundPath(moodData.path);
    path.fillColor = moodData.color;
    path.position = paper.view.center;
    
    // Scale the shape
    const scaleFactor = Math.min(
      window.innerWidth / 1000,
      window.innerHeight / 1000
    );
    path.scale(scaleFactor);
    path.scalingFactor = scaleFactor;
    
    current = path;
    originalPoints = path.firstChild.segments.map(seg => seg.point.clone());
    isWiggling = true;
  }
  
  // Scale the main face video
  const face = document.getElementById('moodFace');
  if (face) {
    const scaleForVideo = Math.min(window.innerWidth / 1000, 1);
    face.style.transform = `translate(-50%, -50%) scale(${scaleForVideo})`;
  }
  
  // Reposition the slider thumb to maintain its relative position
  updateThumbPosition(currentIndex);
}

window.addEventListener('resize', () => {
  // Check if we're on the main page (not in calendar or full-screen view)
  const mainView = document.getElementById('background');
  const calendarView = document.getElementById('calendarView');
  const fullScreenView = document.getElementById('moodDetailsFullScreen');
  
  const isMainPageVisible = mainView && mainView.style.display !== 'none' && 
                           calendarView && calendarView.style.display === 'none' &&
                           fullScreenView && fullScreenView.style.display === 'none';
  
  if (isMainPageVisible) {
    // Handle resize immediately for real-time response
    handleMainPageResize();
    
    // Clear any pending timeout
    clearTimeout(mainPageResizeTimeout);
    
    // Set a flag to indicate we're resizing
    isMainPageResizing = true;
    
    // Reset the flag after a short delay
    mainPageResizeTimeout = setTimeout(() => {
      isMainPageResizing = false;
    }, 100);
  }
});

// Initial setup
resizeCanvas();

// Handle full-screen canvas resize - Real-time approach
let isResizing = false;
let resizeTimeout;

function handleFullScreenResize() {
  // Only handle resize if we're in the full-screen mood details view
  const fullScreenView = document.getElementById('moodDetailsFullScreen');
  const isFullScreenVisible = fullScreenView && fullScreenView.style.display === 'flex';
  
  if (isFullScreenVisible && fullScreenPaper && currentFullScreenMood) {
    // Clear everything and recreate fresh
    fullScreenPaper.project.clear();
    
    // Update canvas size
    const canvas = document.getElementById('moodCanvasFull');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    fullScreenPaper.view.viewSize = new paper.Size(canvas.width, canvas.height);
    
    // Recreate the shape with current mood
    createFullScreenMoodShape(currentFullScreenMood);
    
    // Scale the face video
    const face = document.getElementById('moodFaceFull');
    if (face) {
      const scaleForVideo = Math.min(window.innerWidth / 1000, window.innerHeight / 1000);
      face.style.transform = `translate(-50%, -50%) scale(${scaleForVideo})`;
    }
  }
}

window.addEventListener('resize', () => {
  // Only handle resize if we're in the full-screen mood details view
  const fullScreenView = document.getElementById('moodDetailsFullScreen');
  const isFullScreenVisible = fullScreenView && fullScreenView.style.display === 'flex';
  
  if (isFullScreenVisible && fullScreenPaper && currentFullScreenMood) {
    // Handle resize immediately for real-time response
    handleFullScreenResize();
    
    // Clear any pending timeout
    clearTimeout(resizeTimeout);
    
    // Set a flag to indicate we're resizing
    isResizing = true;
    
    // Reset the flag after a short delay
    resizeTimeout = setTimeout(() => {
      isResizing = false;
    }, 100);
  }
});

  
  // Background click removed - mood changes only via slider interaction
  
  // Load saved theme on page load
  loadSavedTheme();

  // Handle share URL parameters
  function handleShareUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    const mood = urlParams.get('mood');
    const date = urlParams.get('date');
    const isShare = urlParams.get('share');
    
    if (mood && date && isShare) {
      // Show the shared mood GIF
      showSharedMood(mood, date);
    }
  }

  function showSharedMood(mood, date) {
    // Update meta tags for social media sharing
    updateMetaTags(mood, date);
    
    // Hide all main content
    document.getElementById('moodSelection').style.display = 'none';
    document.getElementById('calendarView').style.display = 'none';
    document.getElementById('moodDetailsFullScreen').style.display = 'none';
    
    // Create and show share view
    const shareView = document.createElement('div');
    shareView.id = 'shareView';
    shareView.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--page-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      font-family: 'Gabarito', sans-serif;
    `;
    
    const moodName = mood.charAt(0).toUpperCase() + mood.slice(1);
    const formattedDate = new Date(date).toLocaleDateString('en-US', { 
      month: 'long', 
      day: 'numeric' 
    }).toUpperCase();
    
    shareView.innerHTML = `
      <div style="text-align: center; max-width: 600px; padding: 20px;">
        <h1 style="font-size: 48px; font-weight: bold; color: var(--page-text); margin-bottom: 20px; font-family: 'Gabarito', sans-serif;">
          I'm feeling ${moodName}!
        </h1>
        <div style="margin-bottom: 30px;">
          <img src="share-gifs/${mood}-500x500.gif" alt="${moodName} mood" style="max-width: 400px; width: 100%; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        </div>
        <p style="font-size: 24px; color: var(--page-text); margin-bottom: 30px; font-family: 'Gabarito', sans-serif;">
          ${formattedDate}
        </p>
        <p style="font-size: 18px; color: var(--page-text); margin-bottom: 40px; font-family: 'Gabarito', sans-serif;">
          Track your daily moods with our mood app!
        </p>
        <button onclick="window.location.href='https://allanmacdonalddesign.github.io/mood-app/'" style="
          background: var(--page-stroke);
          color: var(--page-bg);
          border: none;
          padding: 15px 30px;
          border-radius: 25px;
          font-size: 18px;
          font-weight: 700;
          cursor: pointer;
          font-family: 'Gabarito', sans-serif;
          transition: all 0.2s ease;
        " onmouseover="this.style.background='var(--page-text)'" onmouseout="this.style.background='var(--page-stroke)'">
          Try the Mood App
        </button>
      </div>
    `;
    
    document.body.appendChild(shareView);
    
    // Apply mood theme
    applyMoodTheme(mood);
  }

  function updateMetaTags(mood, date) {
    const moodName = mood.charAt(0).toUpperCase() + mood.slice(1);
    const formattedDate = new Date(date).toLocaleDateString('en-US', { 
      month: 'long', 
      day: 'numeric' 
    }).toUpperCase();
    const gifUrl = `https://allanmacdonalddesign.github.io/mood-app/share-gifs/${mood}-500x500.gif`;
    const shareUrl = window.location.href;
    
    // Update Open Graph tags
    document.querySelector('meta[property="og:title"]').setAttribute('content', `I'm feeling ${moodName}! - ${formattedDate}`);
    document.querySelector('meta[property="og:description"]').setAttribute('content', `Track your daily moods with our beautiful mood app!`);
    document.querySelector('meta[property="og:image"]').setAttribute('content', gifUrl);
    document.querySelector('meta[property="og:url"]').setAttribute('content', shareUrl);
    
    // Update Twitter Card tags
    document.querySelector('meta[name="twitter:title"]').setAttribute('content', `I'm feeling ${moodName}! - ${formattedDate}`);
    document.querySelector('meta[name="twitter:description"]').setAttribute('content', `Track your daily moods with our beautiful mood app!`);
    document.querySelector('meta[name="twitter:image"]').setAttribute('content', gifUrl);
    
    // Also update the page title for better sharing
    document.title = `I'm feeling ${moodName}! - Mood App`;
  }

  // Check for share URL on page load
  handleShareUrl();
  </script>
</html>
